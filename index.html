<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Media Viewer</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.min.js"></script>
</head>
<body>
    <div class="header" id="header">
        <div class="title">Media Viewer</div>
        <div class="header-controls">
            <div class="folder-info" id="folderInfo">Current: Liked_0</div>
            <button class="view-mode-btn" id="viewModeBtn" title="Toggle view mode (Single/Compare)" style="display: none;">
                <span class="btn-icon"><i data-lucide="eye"></i></span>
                <span class="btn-label" id="viewModeLabel">Single</span>
            </button>
            <button class="change-folder-btn" id="changeFolderBtn" title="Change source folder" style="display: none;">
                <span class="btn-icon"><i data-lucide="folder-open"></i></span>
                <span class="btn-label">Change source folder</span>
            </button>
            <button class="sort-similarity-btn" id="sortSimilarityBtn" title="Sort by visual similarity. Shift+click to force re-sort (ignores cache)." style="display: none;">
                <span class="btn-icon"><i data-lucide="shuffle"></i></span>
                <span class="btn-label">Sort by Similarity</span>
            </button>
            <select class="sort-algorithm-select" id="sortAlgorithmSelect" title="Choose sorting algorithm" style="display: none;">
                <option value="vptree">VP-Tree (Fastest)</option>
                <option value="mst">MST (Best Quality)</option>
                <option value="simple">Simple (Limited)</option>
            </select>
            <div class="sort-settings" id="sortSettings" style="display: none;">
                <label for="sortKValue" title="Number of neighbors to check per file">K:</label>
                <input type="number" id="sortKValue" min="10" value="500" step="10" title="Number of neighbors to check">
            </div>
            <button class="sort-prediction-btn" id="sortPredictionBtn" title="Sort by predicted preference (learns from your ratings)" style="display: none;" disabled>
                <span class="btn-icon"><i data-lucide="sparkles"></i></span>
                <span class="btn-label">Sort by Predicted</span>
            </button>
            <button class="help-btn" id="helpBtn" title="Show keyboard shortcuts (F1)" style="display: none;">
                <i data-lucide="help-circle"></i>
            </button>
        </div>
    </div>

    <div class="media-container">
        <div class="drop-zone" id="dropZone">
            <div class="drop-icon"><i data-lucide="folder"></i></div>
            <div class="drop-title">Select folder to view media files</div>
            <div class="drop-subtitle">
                Supports: JPG, PNG, GIF, MP4, WebM, MOV
            </div>
        </div>

        <!-- Loading indicator -->
        <div class="loading-container" id="loadingContainer">
            <div class="spinner"></div>
            <div class="loading-text">Loading media...</div>
        </div>

        <!-- Info button (persistent) -->
        <button class="info-toggle-btn" id="infoToggleBtn" title="Toggle file info (I)">
            <i data-lucide="info"></i>
        </button>

        <!-- File info panel - moved to avoid header overlap -->
        <div class="file-info-panel" id="fileInfoPanel">
            <div class="file-info-header">
                <div class="file-name" id="fileName"></div>
                <button class="file-info-close" id="fileInfoClose" title="Close">
                    <i data-lucide="x"></i>
                </button>
            </div>
            <div class="file-details" id="fileDetails"></div>
        </div>

        <!-- Compare mode file info panels -->
        <div class="compare-file-info left-file-info" id="leftFileInfo" style="display: none;">
            <div class="file-info-header">
                <div class="file-name" id="leftFileName"></div>
                <button class="file-info-toggle" id="leftFileInfoToggle" title="Click to copy filename">
                    <i data-lucide="info"></i>
                </button>
            </div>
            <div class="file-details" id="leftFileDetails"></div>
        </div>
        <div class="compare-file-info right-file-info" id="rightFileInfo" style="display: none;">
            <div class="file-info-header">
                <div class="file-name" id="rightFileName"></div>
                <button class="file-info-toggle" id="rightFileInfoToggle" title="Click to copy filename">
                    <i data-lucide="info"></i>
                </button>
            </div>
            <div class="file-details" id="rightFileDetails"></div>
        </div>

        <!-- Navigation info -->
        <div class="navigation-info" id="navInfo">
            <span id="mediaIndex"></span>
        </div>

        <!-- Zoom controls are created dynamically per media pane -->

        <!-- Video controls -->
        <div class="video-controls" id="videoControls">
            <button class="video-control-btn" id="playPauseBtn" title="Play/Pause">
                <i data-lucide="pause" id="pauseIcon"></i>
                <i data-lucide="play" id="playIcon" style="display: none;"></i>
            </button>
            <div class="video-progress-container">
                <input type="range" class="progress-slider" id="progressSlider" min="0" max="100" value="0">
                <div class="time-display">
                    <span id="currentTime">0:00</span> / <span id="totalTime">0:00</span>
                </div>
            </div>
            <div class="volume-container">
                <span class="volume-icon"><i data-lucide="volume-2"></i></span>
                <input type="range" class="volume-slider" id="volumeSlider" min="0" max="1" step="0.1" value="1">
            </div>
            <button class="video-control-btn" id="skipBackwardBtn" title="Skip 10s backward">
                <i data-lucide="skip-back"></i>
            </button>
            <button class="video-control-btn" id="skipForwardBtn" title="Skip 10s forward">
                <i data-lucide="skip-forward"></i>
            </button>
        </div>

        <!-- Main controls for single view -->
        <div class="controls" id="controls">
            <div class="control-btn-wrapper" id="zoomBtnWrapper">
                <button class="control-btn zoom-toggle-btn" id="zoomToggleBtn" title="Zoom controls">
                    <span class="btn-icon"><i data-lucide="zoom-in"></i></span>
                    <span class="btn-label">Zoom</span>
                </button>
            </div>
            <button class="control-btn special-btn" id="specialBtn" title="Move to special folder">
                <span class="btn-icon"><i data-lucide="folder-heart"></i></span>
                <span class="btn-label">Special</span>
            </button>
            <button class="control-btn cancel-btn" id="cancelBtn" title="Undo last move (Ctrl+Left)">
                <span class="btn-icon"><i data-lucide="undo-2"></i></span>
                <span class="btn-label">Undo</span>
            </button>
            <button class="control-btn dislike-btn" id="dislikeBtn" title="Move to previous folder (Down Arrow)">
                <span class="btn-icon"><i data-lucide="thumbs-down"></i></span>
                <span class="btn-label">Dislike</span>
            </button>
            <button class="control-btn like-btn" id="likeBtn" title="Move to next folder (Up Arrow)">
                <span class="btn-icon"><i data-lucide="thumbs-up"></i></span>
                <span class="btn-label">Like</span>
            </button>
        </div>

        <!-- Controls for compare view -->
        <div class="compare-controls" id="compareControls">
            <div class="left-media-controls">
                <button class="control-btn special-btn" id="leftSpecialBtn" title="Move left to special folder">
                    <span class="btn-icon"><i data-lucide="folder-heart"></i></span>
                    <span class="btn-label">Left Special</span>
                </button>
                <button class="control-btn cancel-btn" id="cancelBtnCompare" title="Undo last move (Ctrl+A / Ctrl+Left)">
                    <span class="btn-icon"><i data-lucide="undo-2"></i></span>
                    <span class="btn-label">Undo</span>
                </button>
                <button class="control-btn dislike-btn" id="leftDislikeBtn" title="Left Dislike (W)">
                    <span class="btn-icon"><i data-lucide="thumbs-down"></i></span>
                    <span class="btn-label">Left Dislike</span>
                </button>
                <button class="control-btn like-btn" id="leftLikeBtn" title="Left Like (Q)">
                    <span class="btn-icon"><i data-lucide="thumbs-up"></i></span>
                    <span class="btn-label">Left Like</span>
                </button>
            </div>
            <div class="right-media-controls">
                <button class="control-btn special-btn" id="rightSpecialBtn" title="Move right to special folder">
                    <span class="btn-icon"><i data-lucide="folder-heart"></i></span>
                    <span class="btn-label">Right Special</span>
                </button>
                <button class="control-btn dislike-btn" id="rightDislikeBtn" title="Right Dislike (R)">
                    <span class="btn-icon"><i data-lucide="thumbs-down"></i></span>
                    <span class="btn-label">Right Dislike</span>
                </button>
                <button class="control-btn like-btn" id="rightLikeBtn" title="Right Like (E)">
                    <span class="btn-icon"><i data-lucide="thumbs-up"></i></span>
                    <span class="btn-label">Right Like</span>
                </button>
            </div>
        </div>

        <!-- Navigation arrows -->
        <div class="nav-arrows">
            <button class="nav-arrow nav-prev" id="navPrev" title="Previous media (Left Arrow)">
                <i data-lucide="chevron-left"></i>
            </button>
            <button class="nav-arrow nav-next" id="navNext" title="Next media (Right Arrow)">
                <i data-lucide="chevron-right"></i>
            </button>
        </div>
    </div>

    <!-- Notifications -->
    <div class="notification-container" id="notificationContainer"></div>

    <!-- Keyboard shortcuts help -->
    <div class="help-overlay" id="helpOverlay">
        <div class="help-content">
            <button class="help-close-btn" id="helpCloseBtn" title="Close (Esc or F1)">
                <i data-lucide="x"></i>
            </button>
            <h3>Keyboard Shortcuts</h3>
            <div class="shortcut-section">
                <h4>Single View Mode</h4>
                <div class="shortcut-grid">
                    <div class="shortcut-item">
                        <kbd>↑</kbd> <span>Like (Move to higher folder)</span>
                    </div>
                    <div class="shortcut-item">
                        <kbd>↓</kbd> <span>Dislike (Move to lower folder)</span>
                    </div>
                    <div class="shortcut-item">
                        <kbd>←</kbd> <span>Previous media</span>
                    </div>
                    <div class="shortcut-item">
                        <kbd>→</kbd> <span>Next media</span>
                    </div>
                </div>
            </div>
            <div class="shortcut-section">
                <h4>Compare View Mode</h4>
                <div class="shortcut-grid">
                    <div class="shortcut-item">
                        <kbd>Q</kbd> <span>Left media Like</span>
                    </div>
                    <div class="shortcut-item">
                        <kbd>W</kbd> <span>Left media Dislike</span>
                    </div>
                    <div class="shortcut-item">
                        <kbd>E</kbd> <span>Right media Like</span>
                    </div>
                    <div class="shortcut-item">
                        <kbd>R</kbd> <span>Right media Dislike</span>
                    </div>
                    <div class="shortcut-item">
                        <kbd>Z</kbd> <span>Toggle left media fullscreen</span>
                    </div>
                    <div class="shortcut-item">
                        <kbd>X</kbd> <span>Toggle right media fullscreen</span>
                    </div>
                    <div class="shortcut-item">
                        <kbd>A</kbd> <span>Previous pair</span>
                    </div>
                    <div class="shortcut-item">
                        <kbd>D</kbd> <span>Next pair</span>
                    </div>
                    <div class="shortcut-item">
                        <kbd>Ctrl</kbd> + <kbd>A</kbd> <span>Undo last move</span>
                    </div>
                </div>
            </div>
            <div class="shortcut-section">
                <h4>Zoom</h4>
                <div class="shortcut-grid">
                    <div class="shortcut-item">
                        <kbd>Scroll</kbd> <span>Zoom in/out (on media)</span>
                    </div>
                    <div class="shortcut-item">
                        <kbd>Double-click</kbd> <span>Cycle zoom (1x → 2x → 4x)</span>
                    </div>
                    <div class="shortcut-item">
                        <kbd>Drag</kbd> <span>Pan when zoomed</span>
                    </div>
                    <div class="shortcut-item">
                        <kbd>Esc</kbd> <span>Reset zoom</span>
                    </div>
                </div>
            </div>
            <div class="shortcut-section">
                <h4>General</h4>
                <div class="shortcut-grid">
                    <div class="shortcut-item">
                        <kbd>Ctrl</kbd> + <kbd>←</kbd> <span>Undo last move</span>
                    </div>
                    <div class="shortcut-item">
                        <kbd>Space</kbd> <span>Play/Pause video</span>
                    </div>
                    <div class="shortcut-item">
                        <kbd>Esc</kbd> <span>Exit fullscreen / Reset zoom</span>
                    </div>
                    <div class="shortcut-item">
                        <kbd>F1</kbd> <span>Show/Hide this help</span>
                    </div>
                    <div class="shortcut-item">
                        <kbd>I</kbd> <span>Toggle file info panel</span>
                    </div>
                </div>
            </div>
            <div class="shortcut-section settings-section">
                <h4>Settings</h4>
                <div class="settings-grid">
                    <label class="setting-item">
                        <input type="checkbox" id="showRatingConfirmationsToggle" checked>
                        <span>Show rating confirmation notifications</span>
                    </label>
                    <label class="setting-item">
                        <input type="checkbox" id="autoCloseErrorsToggle">
                        <span>Auto-close error notifications (8s)</span>
                    </label>
                    <label class="setting-item">
                        <input type="checkbox" id="mlPredictionToggle" checked>
                        <span>Enable preference prediction (learns from ratings)</span>
                    </label>
                    <label class="setting-item">
                        <input type="checkbox" id="showPredictionBadgesToggle" checked>
                        <span>Show prediction score badges</span>
                    </label>
                </div>
                <div class="folder-settings">
                    <h5>Rating Folders</h5>
                    <div class="folder-input-group">
                        <label>Like folder:</label>
                        <input type="text" id="likeFolderInput" readonly placeholder="Not configured">
                        <button id="likeFolderBrowse" class="folder-btn" title="Browse for folder">Browse</button>
                        <button id="likeFolderClear" class="folder-btn folder-btn-clear" title="Clear folder">Clear</button>
                    </div>
                    <div class="folder-input-group">
                        <label>Dislike folder:</label>
                        <input type="text" id="dislikeFolderInput" readonly placeholder="Not configured">
                        <button id="dislikeFolderBrowse" class="folder-btn" title="Browse for folder">Browse</button>
                        <button id="dislikeFolderClear" class="folder-btn folder-btn-clear" title="Clear folder">Clear</button>
                    </div>
                    <div id="folderConfigWarning" class="folder-warning">
                        Configure both folders to enable rating buttons
                    </div>
                    <h5>Special Folder</h5>
                    <div class="folder-input-group">
                        <label>Special folder:</label>
                        <input type="text" id="specialFolderInput" readonly placeholder="Not configured">
                        <button id="specialFolderBrowse" class="folder-btn" title="Browse for folder">Browse</button>
                        <button id="specialFolderClear" class="folder-btn folder-btn-clear" title="Clear folder">Clear</button>
                    </div>
                    <div id="specialFolderInfo" class="folder-info-text">
                        Use for trash, favorites, or any custom purpose
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="feature-extractor.js"></script>
    <script src="face-detector.js"></script>
    <script type="module" src="media-viewer.js"></script>
    <script>
        // Initialize Lucide icons after DOM is ready
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof lucide !== 'undefined') {
                lucide.createIcons();
            }
        });
    </script>
</body>
</html>